/**
 * Copyright (c) 2021-2026 Huawei Device Co., Ltd.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package std.core;

// NOTE: autogenerated file

/**
 * The key not found constant.
 *
 * @constant 
 * @type { int }
 * @syscap SystemCapability.Utils.Lang
 * @FaAndStageModel
 * @since 24
 */
export const KEY_NOT_FOUND = -1;

{% for T in ['boolean', 'byte', 'short', 'int', 'long', 'float', 'double', 'char', 'Any'] %}

{% if T != "Any" -%}
// C++ semantics
// (lower|upper)BoundSearch([1, 1, 2, 2, 2, 3, 3], 2, 0, 7)
//                                 ^        ^
//                                 |        |
//                                 |    upper bound
//                             lower bound

/**
 * Tries to find a lower bound of a key in sorted arr.
 * The array has to be sorted before calling this function.
 * Lower bound is an index of a first element, where (element < key) is false. If no such element is found than lower bound is endIndex
 *
 * @param { FixedArray<{{T}}> } arr The array to find a lower bound of a key. Has to be sorted, otherwise the answer is implementation-defined and may be incorrect
 * @param { {{T}} } key The value to find lower bound of
 * @param { int } startIndex The index of arr to begin search with
 * @param { int } endIndex The last index to stop search in arr, i.e. arr[endIndex] is not checked
 * @returns { int } The index such (arr[index] < key) is false. If no such index is found than endIndex
 * @throws { RangeError } Throws if the bounds verification failed
 * @syscap SystemCapability.Utils.Lang
 * @FaAndStageModel
 * @since 24
 */
export function lowerBoundSearch(arr: FixedArray<{{T}}>, key: {{T}}, startIndex: int, endIndex: int): int {
    if (!checkRange(arr.length, startIndex, endIndex)){
        throw new RangeError("lowerBoundSearch: bounds verification failed")
    }

    let left: int = startIndex;
    let len: int = endIndex - startIndex;

    while (len > 0) {
        let half: int = len >>> 1;
        let middle: int = left + half;

        if (arr[middle].compareTo(key) < 0) {
            left = middle + 1;
            len -= half + 1;
        } else {
            len = half;
        }
    }

    return left;
}

/**
 * Tries to find a lower bound of a key in sorted arr.
 * The array has to be sorted before calling this function.
 * Lower bound is an index of a first element, where (element < key) is false. If no such element is found than lower bound is arr.length
 *
 * @param { FixedArray<{{T}}> } arr The array to find a lower bound of a key. Has to be sorted, otherwise the answer is implementation-defined and may be incorrect
 * @param { {{T}} } key The value to find lower bound of
 * @returns { int } The index such (arr[index] < key) is false. If no such index is found than arr.length
 * @syscap SystemCapability.Utils.Lang
 * @FaAndStageModel
 * @since 24
 */
export function lowerBoundSearch(arr: FixedArray<{{T}}>, key: {{T}}): int {
    return lowerBoundSearch(arr, key, 0, arr.length);
}

/**
 * Tries to find an upper bound of a key in sorted arr.
 * The array has to be sorted before calling this function.
 * Upper bound is an index of a first element, where (key < element) is true. If no such element is found than upper bound is endIndex
 *
 * @param { FixedArray<{{T}}> } arr The array to find an upper bound of a key. Has to be sorted, otherwise the answer is implementation-defined and may be incorrect
 * @param { {{T}} } key The value to find upper bound of
 * @param { int } startIndex The index of arr to begin search with
 * @param { int } endIndex The last index to stop search in arr, i.e. arr[endIndex] is not checked
 * @returns { int } The index such (key < arr[index]) is true. If no such index is found than endIndex
 * @syscap SystemCapability.Utils.Lang
 * @FaAndStageModel
 * @since 24
 */
export function upperBoundSearch(arr: FixedArray<{{T}}>, key: {{T}}, startIndex: int, endIndex: int): int {
    if (!checkRange(arr.length, startIndex, endIndex)) {
        throw new RangeError("upperBoundSearch: bounds verification failed")
    }

    let left: int = startIndex;
    let len: int = endIndex - startIndex;

    while (len > 0) {
        let half: int = len >>> 1;
        let middle: int = left + half;

        if (arr[middle].compareTo(key) <= 0) {
            left = middle + 1;
            len -= half + 1;
        } else {
            len = half;
        }
    }

    return left;
}

/**
 * tries to find an upper bound of a key in sorted arr.
 * The array has to be sorted before calling this function.
 * Upper bound is an index of a first element, where (key < element) is true. If no such element is found than upper bound is endIndex
 *
 * @param { FixedArray<{{T}}> } arr The array to find an upper bound of a key. Has to be sorted, otherwise the answer is implementation-defined and may be incorrect
 * @param { {{T}} } key The value to find upper bound of
 * @returns { int } The index such (key < arr[index]) is true. If no such index is found than endIndex
 * @syscap SystemCapability.Utils.Lang
 * @FaAndStageModel
 * @since 24
 */
export function upperBoundSearch(arr: FixedArray<{{T}}>, key: {{T}}): int {
    return upperBoundSearch(arr, key, 0, arr.length);
}

{%- endif %}

/**
 * Makes an array shallow copy
 *
 * @param { FixedArray<{{T}}> } src The array to copy
 * @returns { FixedArray<{{T}}> } The copy of `src`
 * @syscap SystemCapability.Utils.Lang
 * @FaAndStageModel
 * @since 24
 */
export function copyOf(src: FixedArray<{{T}}>): FixedArray<{{T}}> {
    const r : FixedArray<{{T}}> = new FixedArray<{{T}}>(src.length);
    try {
        copyTo(src, r, 0, 0, src.length);
    } catch (e) {
        // ignore
    }
    return r;
}

/**
 * copies src array into dst with respect to passed indexes.
 * dst must have enough space, otherwise out-of-bounds might occur
 *
 * @param { FixedArray<{{T}}> } src The array to copy from
 * @param { FixedArray<{{T}}> } dst The array to copy into
 * @param { int } dstStart The index of dst to start from
 * @param { int } srcStart The index of src to start from
 * @param { int } srcEnd The last index of src to copy, exclusive, i.e. src[srcEnd] is not copied
 * @syscap SystemCapability.Utils.Lang
 * @FaAndStageModel
 * @since 24
 */
export native function copyTo(src: FixedArray<{{T}}>, dst: FixedArray<{{T}}>, dstStart: int, srcStart: int, srcEnd: int): void;
{%- endfor %}
