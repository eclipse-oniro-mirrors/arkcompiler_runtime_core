# Copyright (c) 2026 Huawei Device Co., Ltd.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
cases:
# Function parameter modification doesn't affect original array
    - decl: |-
          function foo(...p: int[]) {
              p[1] = 4
          }
      use: |-
          // Callee modifies its copy, original array unchanged
          let a: int[] = [1, 2, 3]
          foo(...a)
          arktest.assertEQ(a[0], 1)
          arktest.assertEQ(a[1], 2)
          arktest.assertEQ(a[2], 3)

    - decl: |-
          function foo(...p: number[]) {
              p[0] = 99.0
              p[2] = 88.0
          }
      use: |-
          // Multiple element modifications don't affect original
          let a: number[] = [1.0, 2.0, 3.0]
          foo(...a)
          arktest.assertEQ(a[0], 1.0)
          arktest.assertEQ(a[1], 2.0)
          arktest.assertEQ(a[2], 3.0)

    - decl: |-
          function foo(...p: string[]) {
              p[1] = "modified"
              return p
          }
      use: |-
          // Function returns modified copy, original unchanged
          let a: string[] = ["a", "b", "c"]
          let result = foo(...a)
          arktest.assertEQ(result[1], "modified")
          arktest.assertEQ(a[1], "b")

# Array literal spread creates independent copy
    - use: |-
          // Array literal spread creates new array
          let original: int[] = [1, 2, 3]
          let copy = [...original]
          copy[0] = 999
          arktest.assertEQ(original[0], 1)
          arktest.assertEQ(copy[0], 999)

    - use: |-
          // Multiple spreads create independent arrays
          let a: int[] = [1, 2]
          let b = [...a]
          let c = [...a]
          b[0] = 10
          c[0] = 20
          arktest.assertEQ(a[0], 1)
          arktest.assertEQ(b[0], 10)
          arktest.assertEQ(c[0], 20)

# Spread with value types
    - decl: |-
          function foo(...p: byte[]) {
              p[0] = 99 as byte
          }
      use: |-
          // Value type array spread creates copy
          let a: byte[] = [1 as byte, 2 as byte, 3 as byte]
          foo(...a)
          arktest.assertEQ(a[0], 1)
          arktest.assertEQ(a[1], 2)
          arktest.assertEQ(a[2], 3)

    - decl: |-
          function foo(...p: long[]) {
              p[1] = 777 as long
          }
      use: |-
          // Long array spread creates copy
          let a: long[] = [100 as long, 200 as long, 300 as long]
          foo(...a)
          arktest.assertEQ(a[0], 100)
          arktest.assertEQ(a[1], 200)
          arktest.assertEQ(a[2], 300)

    - decl: |-
          function foo(...p: char[]) {
              p[0] = c'Z'
          }
      use: |-
          // Char array spread creates copy
          let a: char[] = [c'a', c'b', c'c']
          foo(...a)
          arktest.assertEQ(a[0], c'a')
          arktest.assertEQ(a[1], c'b')
          arktest.assertEQ(a[2], c'c')

# Spread with FixedArray
    - decl: |-
          function foo(...p: FixedArray<int>) {
              p[0] = 999
          }
      use: |-
          // FixedArray spread creates copy
          let a: FixedArray<int> = [1, 2, 3]
          foo(...a)
          arktest.assertEQ(a[0], 1)
          arktest.assertEQ(a[1], 2)
          arktest.assertEQ(a[2], 3)

    - use: |-
          // FixedArray literal spread creates copy
          let original: FixedArray<number> = [1.0, 2.0, 3.0]
          let copy: number[] = [...original]
          copy[1] = 999.0
          arktest.assertEQ(original[1], 2.0)
          arktest.assertEQ(copy[1], 999.0)

# Spread with tuples
    - decl: |-
          function foo(...p: [int, int][]) {
              p[0][0] = 999
          }
      use: |-
          // Tuple array spread - outer array is copied, inner tuples are references
          let a: [int, int][] = [[1, 2], [3, 4]]
          foo(...a)
          arktest.assertEQ(a[0][0], 999)  // Inner tuple is reference (shallow copy)
          arktest.assertEQ(a[0][1], 2)

# Spread with push/pop operations
    - decl: |-
          function foo(...p: int[]) {
              p.push(999)
          }
      use: |-
          // Push to spread copy doesn't affect original
          let a: int[] = [1, 2, 3]
          foo(...a)
          arktest.assertEQ(a.length, 3)
          arktest.assertEQ(a[0], 1)
          arktest.assertEQ(a[2], 3)

    - use: |-
          // Array literal spread, then push
          let original: string[] = ["a", "b"]
          let copy = [...original]
          copy.push("c")
          arktest.assertEQ(original.length, 2)
          arktest.assertEQ(copy.length, 3)
          arktest.assertEQ(copy[2], "c")

# Spread with complex modifications
    - decl: |-
          function foo(...p: int[]) {
              for (let i = 0; i < p.length; i++) {
                  p[i] = p[i] * 10
              }
          }
      use: |-
          // All elements modified in copy, original unchanged
          let a: int[] = [1, 2, 3, 4, 5]
          foo(...a)
          arktest.assertEQ(a[0], 1)
          arktest.assertEQ(a[2], 3)
          arktest.assertEQ(a[4], 5)
