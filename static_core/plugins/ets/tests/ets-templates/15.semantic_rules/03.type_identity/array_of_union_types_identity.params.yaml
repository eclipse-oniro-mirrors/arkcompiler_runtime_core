# Copyright (c) 2025 Huawei Device Co., Ltd.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

global_tests_data:
  check_variants_for_predefined_types:
    - {check_type_a: "Object | undefined",
      check_type_b: "undefined | Object",
      init_lit: "[5n, undefined, \"abc\"]",
      check_value_0: "5n",
      check_value_1: "undefined",
      check_value_2: "\"abc\""}
    - {check_type_a: "Object | undefined | null",
      check_type_b: "undefined | null | Object",
      init_lit: "[5n, null, undefined]",
      check_value_0: "5n",
      check_value_1: "null",
      check_value_2: "undefined"}
    - {check_type_a: "number | boolean",
      check_type_b: "boolean | number",
      init_lit: "[true, 7.9, false]",
      check_value_0: "true",
      check_value_1: "7.9",
      check_value_2: "false"}
    - {check_type_a: "int | string | boolean",
      check_type_b: "string | boolean | int",
      init_lit: "[true, 5, \"abc\"]",
      check_value_0: "true",
      check_value_1: "5",
      check_value_2: "\"abc\""}
    - {check_type_a: "String",
      check_type_b: "String",
      init_lit: "[\"On Review\", \"In Progress\", \"Done\"]",
      check_value_0: "\"On Review\"",
      check_value_1: "\"In Progress\"",
      check_value_2: "\"Done\""}

  check_variants_for_custom_types:
    - check_type_a: "Cat | Dog | Frog | number"
      check_type_b: "number | Dog | Cat | Frog"
      init_lit: "[new Cat(), 7.8, new Dog(), new Frog()]"
      check_func_0: "check_cat"
      check_func_1: "check_number"
      check_func_2: "check_dog"
      check_func_3: "check_frog"
      cv_decl_data: |-
        class Cat {v: string = "cat"}
        class Dog {v: bigint = 123n}
        class Frog {v: int = 5}
        function check_cat(a: Any) {
          arktest.assertTrue(a instanceof Cat)
          arktest.assertEQ((a as Cat).v, "cat")
        }
        function check_dog(a: Any) {
          arktest.assertTrue(a instanceof Dog)
          arktest.assertEQ((a as Dog).v, 123n)
        }
        function check_frog(a: Any) {
          arktest.assertTrue(a instanceof Frog)
          arktest.assertEQ((a as Frog).v, 5)
        }
        function check_number(a: Any) {
          arktest.assertTrue(a instanceof number)
          arktest.assertEQ(a as number, 7.8)
        }

cases:
  - desc: |-
      >-
        Checking for Array types A[] and Array<B>
        for Union types A and B are identical
        on predefined types on assign operations.
    check_variants: check_variants_for_predefined_types
    sub_cases_logic:
      - |-
        let a: ([check_type_a])[] = [init_lit]
        let b: Array<[check_type_b]> = a
        [common_logic]
      - |-
        let a: Array<[check_type_a]> = [init_lit]
        let b: ([check_type_b])[] = a
        [common_logic]
    common_logic: |-
      arktest.assertTrue(a instanceof Array)
      arktest.assertTrue(b instanceof Array)
      arktest.assertEQ(b.length, 3)
      arktest.assertTrue(b[0] instanceof [check_type_a])
      arktest.assertTrue(b[0] instanceof [check_type_b])
      arktest.assertEQ(b[0], [check_value_0])
      arktest.assertTrue(b[1] instanceof [check_type_a])
      arktest.assertTrue(b[1] instanceof [check_type_b])
      arktest.assertEQ(b[1], [check_value_1])
      arktest.assertTrue(b[2] instanceof [check_type_a])
      arktest.assertTrue(b[2] instanceof [check_type_b])
      arktest.assertEQ(b[2], [check_value_2])
      a = b
      arktest.assertTrue(a instanceof Array)
      arktest.assertEQ(a.length, 3)
      arktest.assertTrue(a[0] instanceof [check_type_a])
      arktest.assertTrue(a[0] instanceof [check_type_b])
      arktest.assertEQ(a[0], [check_value_0])
      arktest.assertTrue(a[1] instanceof [check_type_a])
      arktest.assertTrue(a[1] instanceof [check_type_b])
      arktest.assertEQ(a[1], [check_value_1])
      arktest.assertTrue(a[2] instanceof [check_type_a])
      arktest.assertTrue(a[2] instanceof [check_type_b])
      arktest.assertEQ(a[2], [check_value_2])

  - desc: |-
      >-
        Checking for Array types A[] and Array<B>
        for Union types A and B are identical
        on custom types on assign operations.
    check_variants: check_variants_for_custom_types
    decl_variants:
      - |-
        [cv_decl_data]
    sub_cases_logic:
      - |-
        let a: ([check_type_a])[] = [init_lit]
        let b: Array<[check_type_b]> = a
        [common_logic]
      - |-
        let a: Array<[check_type_a]> = [init_lit]
        let b: ([check_type_b])[] = a
        [common_logic]
    common_logic: |-
      arktest.assertTrue(a instanceof Array)
      arktest.assertTrue(b instanceof Array)
      arktest.assertEQ(b.length, 4)
      arktest.assertTrue(b[0] instanceof [check_type_a])
      arktest.assertTrue(b[0] instanceof [check_type_b])
      [check_func_0](b[0])
      arktest.assertTrue(b[1] instanceof [check_type_a])
      arktest.assertTrue(b[1] instanceof [check_type_b])
      [check_func_1](b[1])
      arktest.assertTrue(b[2] instanceof [check_type_a])
      arktest.assertTrue(b[2] instanceof [check_type_b])
      [check_func_2](b[2])
      arktest.assertTrue(b[3] instanceof [check_type_a])
      arktest.assertTrue(b[3] instanceof [check_type_b])
      [check_func_3](b[3])
      a = b
      arktest.assertTrue(a instanceof Array)
      arktest.assertEQ(a.length, 4)
      arktest.assertTrue(a[0] instanceof [check_type_a])
      arktest.assertTrue(a[0] instanceof [check_type_b])
      [check_func_0](a[0])
      arktest.assertTrue(a[1] instanceof [check_type_a])
      arktest.assertTrue(a[1] instanceof [check_type_b])
      [check_func_1](a[1])
      arktest.assertTrue(a[2] instanceof [check_type_a])
      arktest.assertTrue(a[2] instanceof [check_type_b])
      [check_func_2](a[2])
      arktest.assertTrue(a[3] instanceof [check_type_a])
      arktest.assertTrue(a[3] instanceof [check_type_b])
      [check_func_3](a[3])

  - desc: |-
      >-
        Checking for Array types A[] and Array<B>
        for Union types A and B are identical
        on predefined types by using cast expression.
    check_variants: check_variants_for_predefined_types
    decl_variants:
      - |-
        function cast(p: Object) {
          return p as Array<[check_type_a]>
        }
      - |-
        function cast(p: Object) {
          return p as Array<[check_type_b]>
        }
      - |-
        function cast(p: Object) {
          return p as ([check_type_a])[]
        }
      - |-
        function cast(p: Object) {
          return p as ([check_type_b])[]
        }
      - |-
        function cast(p: Object): Array<[check_type_a]> {
          return p as Array<[check_type_b]>
        }
      - |-
        function cast(p: Object): ([check_type_a])[] {
          return p as ([check_type_b])[]
        }
      - |-
        function cast(p: Object): ([check_type_a])[] {
          return p as Array<[check_type_b]>
        }
      - |-
        function cast(p: Object): Array<[check_type_a]> {
          return p as ([check_type_b])[]
        }
    sub_cases_logic:
      - |-
        let a: ([check_type_a])[] = [init_lit]
        let b: Array<[check_type_b]> = cast(a)
        [common_logic]
      - |-
        let a: Array<[check_type_a]> = [init_lit]
        let b: ([check_type_b])[] = cast(a)
        [common_logic]
    common_logic: |-
      arktest.assertTrue(a instanceof Array)
      arktest.assertTrue(b instanceof Array)
      arktest.assertEQ(b.length, 3)
      arktest.assertTrue(b[0] instanceof [check_type_a])
      arktest.assertTrue(b[0] instanceof [check_type_b])
      arktest.assertEQ(b[0], [check_value_0])
      arktest.assertTrue(b[1] instanceof [check_type_a])
      arktest.assertTrue(b[1] instanceof [check_type_b])
      arktest.assertEQ(b[1], [check_value_1])
      arktest.assertTrue(b[2] instanceof [check_type_a])
      arktest.assertTrue(b[2] instanceof [check_type_b])
      arktest.assertEQ(b[2], [check_value_2])
      a = b
      arktest.assertTrue(a instanceof Array)
      arktest.assertEQ(a.length, 3)
      arktest.assertTrue(a[0] instanceof [check_type_a])
      arktest.assertTrue(a[0] instanceof [check_type_b])
      arktest.assertEQ(a[0], [check_value_0])
      arktest.assertTrue(a[1] instanceof [check_type_a])
      arktest.assertTrue(a[1] instanceof [check_type_b])
      arktest.assertEQ(a[1], [check_value_1])
      arktest.assertTrue(a[2] instanceof [check_type_a])
      arktest.assertTrue(a[2] instanceof [check_type_b])
      arktest.assertEQ(a[2], [check_value_2])

  - desc: |-
      >-
        Checking for Array types A[] and Array<B>
        for Union types A and B are identical
        on custom types by using cast expression.
    check_variants: check_variants_for_custom_types
    decl_variants:
      - |-
        [cv_decl_data]
        function cast(p: Object) {
          return p as Array<[check_type_a]>
        }
      - |-
        [cv_decl_data]
        function cast(p: Object) {
          return p as Array<[check_type_b]>
        }
      - |-
        [cv_decl_data]
        function cast(p: Object) {
          return p as ([check_type_a])[]
        }
      - |-
        [cv_decl_data]
        function cast(p: Object) {
          return p as ([check_type_b])[]
        }
      - |-
        [cv_decl_data]
        function cast(p: Object): Array<[check_type_a]> {
          return p as Array<[check_type_b]>
        }
      - |-
        [cv_decl_data]
        function cast(p: Object): ([check_type_a])[] {
          return p as ([check_type_b])[]
        }
      - |-
        [cv_decl_data]
        function cast(p: Object): ([check_type_a])[] {
          return p as Array<[check_type_b]>
        }
      - |-
        [cv_decl_data]
        function cast(p: Object): Array<[check_type_a]> {
          return p as ([check_type_b])[]
        }
    sub_cases_logic:
      - |-
        let a: ([check_type_a])[] = [init_lit]
        let b: Array<[check_type_b]> = cast(a)
        [common_logic]
      - |-
        let a: Array<[check_type_a]> = [init_lit]
        let b: ([check_type_b])[] = cast(a)
        [common_logic]
    common_logic: |-
      arktest.assertTrue(a instanceof Array)
      arktest.assertTrue(b instanceof Array)
      arktest.assertEQ(b.length, 4)
      arktest.assertTrue(b[0] instanceof [check_type_a])
      arktest.assertTrue(b[0] instanceof [check_type_b])
      [check_func_0](b[0])
      arktest.assertTrue(b[1] instanceof [check_type_a])
      arktest.assertTrue(b[1] instanceof [check_type_b])
      [check_func_1](b[1])
      arktest.assertTrue(b[2] instanceof [check_type_a])
      arktest.assertTrue(b[2] instanceof [check_type_b])
      [check_func_2](b[2])
      arktest.assertTrue(b[3] instanceof [check_type_a])
      arktest.assertTrue(b[3] instanceof [check_type_b])
      [check_func_3](b[3])
      a = b
      arktest.assertTrue(a instanceof Array)
      arktest.assertEQ(a.length, 4)
      arktest.assertTrue(a[0] instanceof [check_type_a])
      arktest.assertTrue(a[0] instanceof [check_type_b])
      [check_func_0](a[0])
      arktest.assertTrue(a[1] instanceof [check_type_a])
      arktest.assertTrue(a[1] instanceof [check_type_b])
      [check_func_1](a[1])
      arktest.assertTrue(a[2] instanceof [check_type_a])
      arktest.assertTrue(a[2] instanceof [check_type_b])
      [check_func_2](a[2])
      arktest.assertTrue(a[3] instanceof [check_type_a])
      arktest.assertTrue(a[3] instanceof [check_type_b])
      [check_func_3](a[3])

  - desc: |-
      >-
        Checking for Array types A[] and Array<B>
        for Union types A and B are identical
        on predefined types on function call.
    check_variants: check_variants_for_predefined_types
    decl_variants:
      - |-
        function foo(p: Array<[check_type_a]>): Array<[check_type_b]> {
          return p
        }
      - |-
        function foo(p: Array<[check_type_b]>): Array<[check_type_a]> {
          return p
        }
      - |-
        function foo(p: Array<[check_type_a]>): ([check_type_a])[] {
          return p
        }
      - |-
        function foo(p: Array<[check_type_a]>): ([check_type_b])[] {
          return p
        }
      - |-
        function foo(p: Array<[check_type_b]>): ([check_type_a])[] {
          return p
        }
      - |-
        function foo(p: ([check_type_a])[]): Array<[check_type_b]> {
          return p
        }
      - |-
        function foo(p: ([check_type_b])[]): Array<[check_type_a]> {
          return p
        }
      - |-
        function foo(p: ([check_type_a])[]): ([check_type_b])[] {
          return p
        }
      - |-
        function foo(p: ([check_type_b])[]): ([check_type_a])[] {
          return p
        }
    sub_cases_logic:
      - |-
        let a: ([check_type_a])[] = [init_lit]
        let b: Array<[check_type_b]> = foo(a)
        [common_logic]
      - |-
        let a: Array<[check_type_a]> = [init_lit]
        let b: ([check_type_b])[] = foo(a)
        [common_logic]
    common_logic: |-
      arktest.assertTrue(a instanceof Array)
      arktest.assertTrue(b instanceof Array)
      arktest.assertEQ(b.length, 3)
      arktest.assertTrue(b[0] instanceof [check_type_a])
      arktest.assertTrue(b[0] instanceof [check_type_b])
      arktest.assertEQ(b[0], [check_value_0])
      arktest.assertTrue(b[1] instanceof [check_type_a])
      arktest.assertTrue(b[1] instanceof [check_type_b])
      arktest.assertEQ(b[1], [check_value_1])
      arktest.assertTrue(b[2] instanceof [check_type_a])
      arktest.assertTrue(b[2] instanceof [check_type_b])
      arktest.assertEQ(b[2], [check_value_2])
      a = b
      arktest.assertTrue(a instanceof Array)
      arktest.assertEQ(a.length, 3)
      arktest.assertTrue(a[0] instanceof [check_type_a])
      arktest.assertTrue(a[0] instanceof [check_type_b])
      arktest.assertEQ(a[0], [check_value_0])
      arktest.assertTrue(a[1] instanceof [check_type_a])
      arktest.assertTrue(a[1] instanceof [check_type_b])
      arktest.assertEQ(a[1], [check_value_1])
      arktest.assertTrue(a[2] instanceof [check_type_a])
      arktest.assertTrue(a[2] instanceof [check_type_b])
      arktest.assertEQ(a[2], [check_value_2])

  - desc: |-
      >-
        Checking for Array types A[] and Array<B>
        for Union types A and B are identical
        on custom types on function call.
    check_variants: check_variants_for_custom_types
    decl_variants:
      - |-
        [cv_decl_data]
        function foo(p: Array<[check_type_a]>): Array<[check_type_b]> {
          return p
        }
      - |-
        [cv_decl_data]
        function foo(p: Array<[check_type_b]>): Array<[check_type_a]> {
          return p
        }
      - |-
        [cv_decl_data]
        function foo(p: Array<[check_type_a]>): ([check_type_a])[] {
          return p
        }
      - |-
        [cv_decl_data]
        function foo(p: Array<[check_type_a]>): ([check_type_b])[] {
          return p
        }
      - |-
        [cv_decl_data]
        function foo(p: Array<[check_type_b]>): ([check_type_a])[] {
          return p
        }
      - |-
        [cv_decl_data]
        function foo(p: ([check_type_a])[]): Array<[check_type_b]> {
          return p
        }
      - |-
        [cv_decl_data]
        function foo(p: ([check_type_b])[]): Array<[check_type_a]> {
          return p
        }
      - |-
        [cv_decl_data]
        function foo(p: ([check_type_a])[]): ([check_type_b])[] {
          return p
        }
      - |-
        [cv_decl_data]
        function foo(p: ([check_type_b])[]): ([check_type_a])[] {
          return p
        }
    sub_cases_logic:
      - |-
        let a: ([check_type_a])[] = [init_lit]
        let b: Array<[check_type_b]> = foo(a)
        [common_logic]
      - |-
        let a: Array<[check_type_a]> = [init_lit]
        let b: ([check_type_b])[] = foo(a)
        [common_logic]
    common_logic: |-
      arktest.assertTrue(a instanceof Array)
      arktest.assertTrue(b instanceof Array)
      arktest.assertEQ(b.length, 4)
      arktest.assertTrue(b[0] instanceof [check_type_a])
      arktest.assertTrue(b[0] instanceof [check_type_b])
      [check_func_0](b[0])
      arktest.assertTrue(b[1] instanceof [check_type_a])
      arktest.assertTrue(b[1] instanceof [check_type_b])
      [check_func_1](b[1])
      arktest.assertTrue(b[2] instanceof [check_type_a])
      arktest.assertTrue(b[2] instanceof [check_type_b])
      [check_func_2](b[2])
      arktest.assertTrue(b[3] instanceof [check_type_a])
      arktest.assertTrue(b[3] instanceof [check_type_b])
      [check_func_3](b[3])
      a = b
      arktest.assertTrue(a instanceof Array)
      arktest.assertEQ(a.length, 4)
      arktest.assertTrue(a[0] instanceof [check_type_a])
      arktest.assertTrue(a[0] instanceof [check_type_b])
      [check_func_0](a[0])
      arktest.assertTrue(a[1] instanceof [check_type_a])
      arktest.assertTrue(a[1] instanceof [check_type_b])
      [check_func_1](a[1])
      arktest.assertTrue(a[2] instanceof [check_type_a])
      arktest.assertTrue(a[2] instanceof [check_type_b])
      [check_func_2](a[2])
      arktest.assertTrue(a[3] instanceof [check_type_a])
      arktest.assertTrue(a[3] instanceof [check_type_b])
      [check_func_3](a[3])
