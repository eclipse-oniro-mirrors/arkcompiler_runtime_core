# LibPandaBase Module AGENTS.md

> Verified on commit: f965a250e9a4ad664a282f7e220a42a744964a5a
> Last updated: 2026-02-13
> Assumed workspace: arkcompiler/runtime_core/libpandabase
> Scope: libpandabase/

## Purpose

Provides memory management (Arena/Pool/Code allocators), OS abstraction (file/thread/mutex/time), utilities (logging/JSON/UTF/command-line parsing/work queue), and a cross-platform adaptation layer; maintains the code-generation pipeline for the event system, options system, and logger system.

## Quick Start

### Build Commands

```bash
# Build shared library libarkbase
./build.sh --product-name <product_name> --build-target arkcompiler/runtime_core/libpandabase:libarkbase

# Build static library
./build.sh --product-name <product_name> --build-target arkcompiler/runtime_core/libpandabase:libarkbase_static

# Build frontend toolchain static library
./build.sh --product-name <product_name> --build-target arkcompiler/runtime_core/libpandabase:libarkbase_frontend_static
```

### Test Commands

```bash
# Run all runtime_core host unit tests (including LibPandaBaseTest)
./build.sh --product-name <product_name> --build-target arkcompiler/runtime_core:runtime_core_host_unittest

# Run only libpandabase module unit tests
./build.sh --product-name <product_name> --build-target arkcompiler/runtime_core/libpandabase/tests:host_unittest
```

## Where to Edit

### Module Entry Points

- `libpandabase/BUILD.gn` - GN: libarkbase (static/shared) + code-gen rules
- Code generation sources: `events/events.yaml`, `options.yaml`, `templates/logger.yaml`
- Source implementations: `libpandabase/mem/*.cpp`, `libpandabase/os/*.cpp`, `libpandabase/utils/*.cpp`, `libpandabase/trace/*.cpp`

### Module-Specific "Do Not Edit" Boundaries

⚠️ **Critical**: This module uses **code generation** (Ruby + ERB + YAML). Do not hand-write logic that duplicates generated output.
- ⚠️ Do not edit generated files in build directory (e.g. `build/**/events_gen.h`, `build/**/base_options.h`). Edit data sources/templates and regenerate.
- ⚠️ Do not modify `platforms/unix/libpandabase/` and `platforms/windows/libpandabase/` (platform implementations live under `platforms/`).

### Code-Generation Rules

- New logger components: edit `templates/logger.yaml`; merged by `logger_gen.rb` then generated
- New events: edit `events/events.yaml`; generated by `events.rb` + `events_gen.h.erb`
- New command-line options: edit `options.yaml`; generated by `../templates/options/options.h.erb` + `../templates/common.rb`

## Validation Checklist

### Module-Specific Test Commands

The GN test target `LibPandaBaseTest` links the `libarkbase_static` library.

### Module Dependencies

**Key upstream dependencies**:
- `json:nlohmann_json_static` — Third-party JSON library
- `$ark_root:concat_plugins_yamls` — Plugin YAML merge (required for logger generation)
- `sdk_libc_secshared_dep` — C secure function library

**Key downstream dependents**:
- `libpandafile/`, `libziparchive/`, `assembler/`, `compiler/` - Core runtime components
- Almost every runtime_core submodule depends on this module directly or indirectly

## References

- Verified: BUILD.gn defines static/shared library targets and code-generation rules
- Verified: Cross-platform with platform-specific implementations in `platforms/` directories
- Verified: Code-generation pipeline uses Ruby + ERB + YAML for events, options, and logger systems
